<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VinceVision Kicks Launch Seat Booking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        #timer {
            font-size: 24px;
            color: #ff0000;
            margin: 10px 0;
        }
        .seat-container {
            display: grid;
            grid-template-columns: repeat(10, 50px);
            gap: 5px;
            justify-content: center;
            margin: 20px auto;
            max-width: 600px;
        }
        .seat {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #fff;
            cursor: not-allowed;
            border: 1px solid #999;
            position: relative;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .seat-number {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(0,0,0,0.5);
            color: white;
            padding: 2px;
            font-size: 10px;
        }
        .free {
            background-image: url('https://media.gettyimages.com/id/173573801/photo/theater-seats-in-an-empty-auditorium.jpg?s=612x612&w=gi&k=20&c=CX0gvsmWsVIV5-pdfKhAV8rgZ9yTHZMAWlVRoiU20ts=');
            cursor: pointer;
        }
        .free:hover {
            opacity: 0.8;
        }
        .vip {
            background-image: url('https://buflusevents.com/wp-content/uploads/2021/11/Gold-VIP-seats.jpg');
            color: #000;
            cursor: not-allowed;
        }
        .booked {
            background-image: url('https://media.gettyimages.com/id/200127563-001/photo/red-theater-seats-with-reserved-signs.jpg?s=612x612&w=gi&k=20&c=5qkb9-rnw6VubxnFrFanOrUEn9u_eruYTL4QJl3fKV0=');
            filter: grayscale(100%);
        }
        #status {
            margin-top: 20px;
            font-size: 18px;
            color: #333;
        }
        dialog {
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background: white;
            width: 300px;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        label {
            text-align: left;
        }
        input, select, textarea {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        #blocked-message {
            color: red;
            font-size: 20px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>VinceVision Kicks Launch Seat Booking</h1>
    <p>Total Seats: 78 | Free Seats: <span id="free-count">77</span></p>
    <p>Bookings must be completed before October 20, 2025.</p>
    <div id="timer"></div>
    <div id="blocked-message" style="display: none;"></div>
    <div class="seat-container" id="seat-container"></div>
    <div id="status"></div>

    <dialog id="triviaModal">
        <h2>Trivia Quiz</h2>
        <p>Answer correctly to proceed with booking.</p>
        <form id="triviaForm">
            <label for="ceo">Who is the CEO?</label>
            <input type="text" id="ceo" required>

            <label for="iphone">What's the toughest slimmest iPhone?</label>
            <input type="text" id="iphone" required>

            <button type="submit">Submit Answers</button>
        </form>
    </dialog>

    <dialog id="bookingModal">
        <h2>Book Seat <span id="selected-seat"></span></h2>
        <form id="bookingForm">
            <label for="name">Name:</label>
            <input type="text" id="name" required>

            <label for="phone">Phone Number:</label>
            <input type="tel" id="phone" required>

            <label for="id">ID (National ID):</label>
            <input type="text" id="id" required>

            <label for="age">Age (must be at least 18):</label>
            <input type="number" id="age" min="18" required>

            <label for="phoneModel">Preferred Phone Model:</label>
            <select id="phoneModel" required>
                <option value="">Select...</option>
                <option value="iPhone 14 Pro 256GB">iPhone 14 Pro 256GB</option>
                <option value="iPhone 14 Pro Max 256GB">iPhone 14 Pro Max 256GB</option>
                <option value="iPhone 14 Plain 256GB">iPhone 14 Plain 256GB</option>
                <option value="Samsung S25 Ultra">Samsung S25 Ultra</option>
            </select>

            <label for="shoeSize">Shoe Size (for free shoes):</label>
            <input type="number" id="shoeSize" min="1" max="50" required>

            <label for="howKnow">How do you know VinceVision?</label>
            <textarea id="howKnow" required></textarea>

            <button type="submit">Submit</button>
        </form>
    </dialog>

    <script>
        const totalSeats = 78;
        const vipSeat = 1;
        const whatsappNumber = '+254742850266';
        const deadline = new Date('2025-10-20T00:00:00');
        const container = document.getElementById('seat-container');
        const triviaModal = document.getElementById('triviaModal');
        const triviaForm = document.getElementById('triviaForm');
        const bookingModal = document.getElementById('bookingModal');
        const form = document.getElementById('bookingForm');
        const selectedSeatSpan = document.getElementById('selected-seat');
        const timerDiv = document.getElementById('timer');
        const freeCountSpan = document.getElementById('free-count');
        const statusDiv = document.getElementById('status');
        const blockedMessage = document.getElementById('blocked-message');

        let bookedSeats = JSON.parse(localStorage.getItem('bookedSeats')) || {};
        let isBlocked = localStorage.getItem('blocked') === 'true';
        let triviaInProgress = localStorage.getItem('triviaInProgress');
        let freeCount = totalSeats - 1 - Object.keys(bookedSeats).length; // All except VIP
        freeCountSpan.textContent = freeCount;

        let currentSeat = null;

        if (triviaInProgress && !isBlocked) {
            isBlocked = true;
            localStorage.setItem('blocked', 'true');
            localStorage.removeItem('triviaInProgress');
        }

        if (isBlocked) {
            blockedMessage.textContent = 'You are blocked because you exited during the trivia quiz. Reason: Attempted to evade trivia questions.';
            blockedMessage.style.display = 'block';
            statusDiv.textContent = 'Bookings are disabled for you.';
        }

        function updateTimer() {
            const now = new Date();
            const timeLeft = deadline - now;

            if (timeLeft <= 0) {
                timerDiv.textContent = 'Booking period has ended!';
                disableBookings();
                return;
            }

            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            timerDiv.textContent = `Time left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        function disableBookings() {
            const freeSeatsElems = document.querySelectorAll('.free');
            freeSeatsElems.forEach(seat => {
                seat.classList.remove('free');
                seat.classList.add('booked');
                seat.removeEventListener('click', startTrivia);
            });
            statusDiv.textContent = 'Bookings are closed.';
        }

        function startTrivia() {
            if (isBlocked) return;
            currentSeat = this.dataset.seat;
            localStorage.setItem('triviaInProgress', currentSeat);
            window.onbeforeunload = () => 'Leaving will reject your booking and block you.';
            triviaModal.showModal();
        }

        function initSeats() {
            for (let i = 1; i <= totalSeats; i++) {
                const seat = document.createElement('div');
                seat.classList.add('seat');
                seat.dataset.seat = i;

                const seatNumber = document.createElement('div');
                seatNumber.classList.add('seat-number');
                seatNumber.textContent = i;
                seat.appendChild(seatNumber);

                if (i === vipSeat) {
                    seat.classList.add('vip');
                    seat.title = 'Reserved for CEO Mr. Vincent Omondi';
                } else if (!bookedSeats[i]) {
                    seat.classList.add('free');
                    if (!isBlocked) {
                        seat.addEventListener('click', startTrivia);
                    }
                    seat.title = 'Available Seat';
                } else {
                    seat.classList.add('booked');
                    seat.title = `Booked by ${bookedSeats[i].name}`;
                }

                container.appendChild(seat);
            }
        }

        triviaForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const ceo = document.getElementById('ceo').value.toLowerCase().trim();
            const iphone = document.getElementById('iphone').value.toLowerCase().trim();

            if (ceo === 'vincent' && iphone === 'iphone 17 air') {
                localStorage.removeItem('triviaInProgress');
                window.onbeforeunload = null;
                triviaModal.close();
                selectedSeatSpan.textContent = currentSeat;
                bookingModal.showModal();
            } else {
                alert('Incorrect answers. Booking denied.');
                localStorage.removeItem('triviaInProgress');
                window.onbeforeunload = null;
                triviaModal.close();
            }
            triviaForm.reset();
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const idNum = document.getElementById('id').value;
            const age = parseInt(document.getElementById('age').value);
            const phoneModel = document.getElementById('phoneModel').value;
            const shoeSize = document.getElementById('shoeSize').value;
            const howKnow = document.getElementById('howKnow').value;

            if (age < 18) {
                alert('You must be at least 18 years old to book.');
                return;
            }

            const info = `Seat: ${currentSeat}\nName: ${name}\nPhone: ${phone}\nID: ${idNum}\nAge: ${age}\nPhone Model: ${phoneModel}\nShoe Size: ${shoeSize}\nHow I know VinceVision: ${howKnow}`;

            if (confirm(`Confirm booking:\n${info}`)) {
                bookedSeats[currentSeat] = { name, phone, idNum, age, phoneModel, shoeSize, howKnow };
                localStorage.setItem('bookedSeats', JSON.stringify(bookedSeats));

                const seatElem = document.querySelector(`.seat[data-seat="${currentSeat}"]`);
                seatElem.classList.remove('free');
                seatElem.classList.add('booked');
                seatElem.removeEventListener('click', startTrivia);
                seatElem.title = `Booked by ${name}`;

                freeCount--;
                freeCountSpan.textContent = freeCount;
                statusDiv.textContent = `Seat ${currentSeat} booked by ${name}!`;

                const message = encodeURIComponent(`I have booked seat ${currentSeat}. Details:\nName: ${name}\nPhone: ${phone}\nID: ${idNum}\nAge: ${age}\nPhone Model: ${phoneModel}\nShoe Size: ${shoeSize}\nHow I know VinceVision: ${howKnow}`);
                window.location.href = `https://wa.me/${whatsappNumber}?text=${message}`;
            }

            bookingModal.close();
            form.reset();
        });

        updateTimer();
        setInterval(updateTimer, 1000);

        const now = new Date();
        if (now >= deadline) {
            disableBookings();
        } else {
            initSeats();
        }

        statusDiv.textContent = `Only ${freeCount} seats left!`;
    </script>
</body>
</html>
